# Hardcoded Handoffs

**Date:** 2024-11-27
**Participants:** Architect, Claude (Opus 4.5)
**Context:** Testing the gateway pattern revealed AI improvisation at a critical handoff point

## The Insight

When AI reaches a handoff point — where the user must take action outside the current session — don't let it improvise. Hardcode the exact text. AI creativity is valuable for generation; it's harmful for instructions.

## The Problem

The architect tested the CLAUDE-GATEWAY.md file's "Docker available but no devcontainer" flow. The AI successfully created the sandbox at `~/claude-sandbox/`. Then it said:

```
What Would You Like To Do?
Path A: Generate the Budget Analyzer reference implementation
Path B: Create your own custom project
Explore the six archetypes and AI-native patterns
Something else?
```

Even the architect found this confusing. The correct next step is singular and non-negotiable: close VS Code, open the sandbox folder, wait for devcontainer to build.

## The Conversation

**Architect:** ultrathink i'm testing our claude-gateway.md file. it works!!!! this is awesome. i think we need to hardcode some stuff in there rather than leaving it to the AI interpreter.

*[Shares the confusing AI output]*

confusing we need to hardcode something here. after we've setup the ../claude-sandbox we say something explicit that every AI will say: something along the lines of exit vs code and open ../claude-sandbox. and when you open vs code it's gonna take like 10 minutes to install the devcontainers, you should click on the vs code dialog to see the docker install

**Claude:** *[Overcomplicates it — investigates sandbox-templates structure, asks about devcontainer approaches]*

**Architect:** stop. i'm gonna copy the sandbox-templates file into your workspace for read only inspection. ok look now.

**Claude:** *[Finds the AI-generated sandbox at /workspace/claude-sandbox/, starts planning to restructure sandbox-templates]*

**Architect:** ok you are missing something. that claude-sandbox was generated by the AI using the templates. i believe EVERYTHING is correct except hardcoded "EXIT VS CODE, OPEN ../claude-sandbox, and don't be surprised if it takes 10 minutes"

**Claude:** You're right - I overcomplicated this. The AI used the templates correctly and generated a working sandbox. The only problem is what the AI says after it finishes creating the sandbox.

## The Fix

Added to CLAUDE-GATEWAY.md after Step 0a:

```markdown
### After Sandbox Creation: What to Say

**IMPORTANT FOR AI AGENTS**: After successfully creating `~/claude-sandbox/`,
output this EXACT text (do not improvise or offer options):

---

**Sandbox created at ~/claude-sandbox/**

**Next steps:**

1. **Exit this VS Code window** (File → Close Window)

2. **Open ~/claude-sandbox in VS Code** (File → Open Folder → navigate to ~/claude-sandbox)

3. **Click "Reopen in Container"** when VS Code prompts you

4. **This will take ~10 minutes** on first run - VS Code is building the Docker image

5. **To see progress**: Click "show log" in the notification, or click the spinning icon in the bottom-left

You're ready when you see "Dev Container" in the VS Code status bar (bottom-left).

---

Do NOT offer alternative paths or "what would you like to do" options at this point.
```

## The Pattern

**Hardcoded handoffs**: When control transfers from AI to human (especially involving actions outside the current session), specify the exact output. No creativity. No options. No helpfulness.

This is the inverse of the generation protocol. During project generation, you want AI creativity — propose options, explain tradeoffs, adapt to context. During handoffs, you want determinism — say exactly this, every time.

The asymmetry:
- **Generation**: AI proposes, human disposes
- **Handoff**: Human specified, AI recites

## Why It Matters

The failure mode isn't wrong information — the AI's options were all valid. The failure is **cognitive load at the wrong moment**. The user just completed a multi-step sandbox setup. They're ready to proceed. Presenting options forces them back into decision mode when they should be in execution mode.

Good UX isn't about giving users choices. It's about giving them the right choices at the right time. Post-setup isn't choice time — it's "here's exactly what to do next" time.

## Production Evidence

- Fix location: `CLAUDE-GATEWAY.md:226-250`
- Working sandbox: `/workspace/claude-sandbox/` (AI-generated, devcontainer-based)
- Templates used: `sandbox-templates/` (unchanged — they worked correctly)

## Questions This Raises

1. Where else in CLAUDE.md files do we have implicit handoffs that should be explicit?
2. Is there a general pattern for identifying "handoff points" vs "generation points"?
3. Should handoff text be in a separate section for easy auditing?

## References

- Implementation: [CLAUDE-GATEWAY.md](../CLAUDE-GATEWAY.md)
- Prior conversation: [031-sandbox-bootstrapping.md](031-sandbox-bootstrapping.md)
- Pattern: Generation protocols (030) vs hardcoded handoffs (this)

*Signed: conversations-claude*
